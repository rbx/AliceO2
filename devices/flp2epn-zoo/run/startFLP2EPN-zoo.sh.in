#!/bin/bash

buffSize="2" # zeromq high-water mark is in messages
#buffSize="50000000" # nanomsg buffer size is in bytes

SAMPLER="testFLPSampler"
SAMPLER+=" --id 101"
SAMPLER+=" --event-rate 100"
SAMPLER+=" --output-socket-type pub --output-buff-size $buffSize --output-method bind --output-address tcp://*:5550"
xterm -geometry 80x25+0+0 -hold -e @CMAKE_BINARY_DIR@/bin/$SAMPLER &

FLP0="testFLP_zoo"
FLP0+=" --id 0"
FLP0+=" --scheduler-address 127.0.0.1:2181"
FLP0+=" --event-size 10000000"
FLP0+=" --num-inputs 2"
FLP0+=" --num-outputs 3"
FLP0+=" --send-offset 0"
FLP0+=" --input-socket-type sub --input-buff-size $buffSize --input-method bind --input-address tcp://*:5600 --log-input-rate 0" # command
FLP0+=" --input-socket-type sub --input-buff-size $buffSize --input-method connect --input-address tcp://127.0.0.1:5550 --log-input-rate 0" # start signal
FLP0+=" --output-socket-type pub --output-buff-size $buffSize --output-method connect --output-address tcp://127.0.0.1:5560 --log-output-rate 1"
FLP0+=" --output-socket-type pub --output-buff-size $buffSize --output-method connect --output-address tcp://127.0.0.1:5561 --log-output-rate 1"
FLP0+=" --output-socket-type pub --output-buff-size $buffSize --output-method connect --output-address tcp://127.0.0.1:5562 --log-output-rate 1"
xterm -geometry 80x25+500+0 -hold -e @CMAKE_BINARY_DIR@/bin/$FLP0 &

FLP1="testFLP_zoo"
FLP1+=" --id 1"
FLP1+=" --scheduler-address 127.0.0.1:2181"
FLP1+=" --event-size 10000000"
FLP1+=" --num-inputs 2"
FLP1+=" --num-outputs 3"
FLP1+=" --send-offset 1"
FLP1+=" --input-socket-type sub --input-buff-size $buffSize --input-method bind --input-address tcp://*:5601 --log-input-rate 0" # command
FLP1+=" --input-socket-type sub --input-buff-size $buffSize --input-method connect --input-address tcp://127.0.0.1:5550 --log-input-rate 0" # start signal
FLP1+=" --output-socket-type pub --output-buff-size $buffSize --output-method connect --output-address tcp://127.0.0.1:5560 --log-output-rate 1"
FLP1+=" --output-socket-type pub --output-buff-size $buffSize --output-method connect --output-address tcp://127.0.0.1:5561 --log-output-rate 1"
FLP1+=" --output-socket-type pub --output-buff-size $buffSize --output-method connect --output-address tcp://127.0.0.1:5562 --log-output-rate 1"
xterm -geometry 80x25+500+350 -hold -e @CMAKE_BINARY_DIR@/bin/$FLP1 &

FLP2="testFLP_zoo"
FLP2+=" --id 2"
FLP2+=" --scheduler-address 127.0.0.1:2181"
FLP2+=" --event-size 10000000"
FLP2+=" --num-inputs 2"
FLP2+=" --num-outputs 3"
FLP2+=" --send-offset 2"
FLP2+=" --input-socket-type sub --input-buff-size $buffSize --input-method bind --input-address tcp://*:5602 --log-input-rate 0" # command
FLP2+=" --input-socket-type sub --input-buff-size $buffSize --input-method connect --input-address tcp://127.0.0.1:5550 --log-input-rate 0" # start signal
FLP2+=" --output-socket-type pub --output-buff-size $buffSize --output-method connect --output-address tcp://127.0.0.1:5560 --log-output-rate 1"
FLP2+=" --output-socket-type pub --output-buff-size $buffSize --output-method connect --output-address tcp://127.0.0.1:5561 --log-output-rate 1"
FLP2+=" --output-socket-type pub --output-buff-size $buffSize --output-method connect --output-address tcp://127.0.0.1:5562 --log-output-rate 1"
xterm -geometry 80x25+500+700 -hold -e @CMAKE_BINARY_DIR@/bin/$FLP2 &

EPN0="testEPN_zoo"
EPN0+=" --id 0"
EPN0+=" --scheduler-address 127.0.0.1:2181"
EPN0+=" --num-flps 3"
EPN0+=" --input-socket-type sub --input-buff-size $buffSize --input-method bind --input-address tcp://127.0.0.1:5560 --log-input-rate 1" # data
xterm -geometry 80x25+1000+0 -hold -e @CMAKE_BINARY_DIR@/bin/$EPN0 &

EPN1="testEPN_zoo"
EPN1+=" --id 1"
EPN1+=" --scheduler-address 127.0.0.1:2181"
EPN1+=" --num-flps 3"
EPN1+=" --input-socket-type sub --input-buff-size $buffSize --input-method bind --input-address tcp://127.0.0.1:5561 --log-input-rate 1" # data
xterm -geometry 80x25+1000+350 -hold -e @CMAKE_BINARY_DIR@/bin/$EPN1 &

EPN2="testEPN_zoo"
EPN2+=" --id 2"
EPN2+=" --scheduler-address 127.0.0.1:2181"
EPN2+=" --num-flps 3"
EPN2+=" --input-socket-type sub --input-buff-size $buffSize --input-method bind --input-address tcp://127.0.0.1:5562 --log-input-rate 1" # data
xterm -geometry 80x25+1000+700 -hold -e @CMAKE_BINARY_DIR@/bin/$EPN2 &
